# 🧳 Visitor Pattern: "مهمون محترمی که وسایلشو خودش می‌چینه"

### 🧠 تعریف خیلی غیررسمی:

فرض کن یه خونه‌ی بزرگ داری (مثلاً یه جنگل کلاس‌ها)، و می‌خوای افراد مختلف (بازدیدکننده‌ها) بیان و هر کدوم یه کاری روی اتاق‌ها (کلاس‌ها) انجام بدن. حالا اگه به هر کسی کلید خونه رو بدی تا تو اتاق‌ها بچرخه و کاراشو بکنه، یه فاجعه میشه!
اینجا **Visitor Pattern** وارد میشه:
اون مهمونه رو می‌فرستی داخل، ولی طبق قانون مشخص. خونه می‌دونه چطوری باید بهش خوش‌آمد بگه، و مهمون می‌دونه باید چیکار کنه.

---

### 🎯 کاربرد واقعی‌اش کجاست؟

- وقتی می‌خوای **رفتار جدیدی به کلاس‌ها اضافه کنی** بدون اینکه تغییرشون بدی
- وقتی یه ساختار **درختی یا ترکیبی** داری (مثل فایل‌ها، AST، HTML،...) و می‌خوای روش عملیات‌های مختلف انجام بدی (مثلاً شمارش، پرینت، رسم درخت، و غیره)

---

### 🧩 ساختار ساده:

```ts
// Element interface
interface Shape {
  accept(visitor: ShapeVisitor): void;
}

// Concrete Elements
class Circle implements Shape {
  accept(visitor: ShapeVisitor) {
    visitor.visitCircle(this);
  }
}

class Square implements Shape {
  accept(visitor: ShapeVisitor) {
    visitor.visitSquare(this);
  }
}

// Visitor interface
interface ShapeVisitor {
  visitCircle(c: Circle): void;
  visitSquare(s: Square): void;
}

// Concrete Visitor
class RenderVisitor implements ShapeVisitor {
  visitCircle(c: Circle) {
    console.log("🔵 رسم دایره");
  }
  visitSquare(s: Square) {
    console.log("🟥 رسم مربع");
  }
}

// استفاده:
const shapes: Shape[] = [new Circle(), new Square()];
const renderer = new RenderVisitor();

for (const shape of shapes) {
  shape.accept(renderer);
}
```

---

### 🔍 به زبون ساده چه اتفاقی افتاد؟

- هر **شکل (Element)** به یک **بازدیدکننده (Visitor)** اجازه داد وارد بشه و روش یه کاری انجام بده.
- بدون اینکه **کلاس شکل‌ها رو دست بزنیم**، تونستیم عملیات جدید (رندر) اضافه کنیم.

---

### ❗ مزایا:

- کدهای جدید بدون دست زدن به کلاس‌های اصلی اضافه می‌شن.
- رفتارهای مختلف رو می‌تونی در بازدیدکننده‌های مختلف بنویسی.
- عالی برای ساختارهای پیچیده مثل AST یا درخت فایل.

### 🧱 معایب:

- اگه کلاس‌هات زیاد تغییر کنن، بازدیدکننده‌هات هم باید آپدیت بشن.
- ممکنه پیاده‌سازی Visitor برای چیزهای ساده یه کم بیش از حد باشه.

---

### 🤹‍♂️ Codexiuo-style تشبیه:

فرض کن هر کلاس یه اتاق تو خونه‌ست. مهمون‌ها (Visitorها) می‌دونن تو کدوم اتاق باید چی کار کنن.
ولی اتاقا خودشون نمی‌دونن کار مهمون چیه. فقط یه جمله می‌گن:

> "بیا داخل، کارت رو بکن ولی خراب نکن لطفاً."

---

### 🪄 نمونه کاربردهای واقعی:

- کامپایلرها (عملیات روی درخت نحوی)
- تبدیل فرمت اسناد
- مرور یا آنالیز گراف‌ها و درخت‌ها
- گزارش‌گیری از داده‌های پیچیده
