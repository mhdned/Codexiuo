# 📚 SAGA

**Saga** یه الگوی طراحی توی معماری Microservices هست که برای مدیریت **تراکنش‌های توزیع‌شده** (Distributed Transactions) استفاده میشه.

---

## 🔧 چرا Saga؟

توی Microservices، یه تراکنش ممکنه چندتا سرویس رو درگیر کنه. مثلا:

- ثبت سفارش
- کم کردن موجودی انبار
- پرداخت
- ...

اگه وسط این کارها یه سرویس Fail کنه (مثلا پرداخت شکست بخوره)، باید بتونیم **همه چیز رو به حالت قبل برگردونیم**.

---

## 🌟 ایده اصلی

به جای یه تراکنش بزرگ و سراسری، Saga میگه:

> هر کدوم از این مراحل (Steps) رو به عنوان یه تراکنش کوچیک ببین.  
> اگه یه Step شکست خورد، یه **تراکنش جبرانی** (Compensating Transaction) اجرا کن!

---

## 🎯 مدل‌های اصلی پیاده‌سازی

### 1️⃣ Choreography-based Saga

- سرویس‌ها مستقیم با هم Event رد و بدل می‌کنن.
- هر سرویس وقتی کارش تموم شد، Event بعدی رو منتشر می‌کنه.
- اگه خطا خورد، یه Event جبرانی می‌فرسته (مثلا: OrderCancelled).

### 2️⃣ Orchestration-based Saga

- یه **Saga Orchestrator** (سرویس مرکزی) همه چیز رو مدیریت می‌کنه.
- Orchestrator به هر سرویس میگه «چه کاری انجام بده».
- اگه خطا خورد، Orchestrator سرویس‌های قبلی رو خبر می‌کنه که جبران کنن.

---

## ⚖️ مزایا و معایب

✅ **مزایا**:

- مدیریت تراکنش‌ها به شکل ماژولار.
- مناسب برای محیط‌های Event-driven.
- بدون نیاز به 2PC یا تراکنش‌های سنگین.

❌ **معایب**:

- پیچیدگی در طراحی و پیاده‌سازی.
- نیاز به هماهنگی دقیق بین سرویس‌ها.
- مدیریت Eventها یا Orchestrator چالش‌برانگیز میشه.

---

## 🪄 نتیجه‌گیری

**Saga** به ما کمک می‌کنه تراکنش‌های توزیع‌شده رو به روشی قابل‌کنترل و Event-driven انجام بدیم.  
کلید موفقیت توی پیاده‌سازیش اینه:

> خوب طراحی کن، و مطمئن شو که **Compensating Transaction**ها همیشه آماده‌ن! 🚀
